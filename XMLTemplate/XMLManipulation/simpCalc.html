<html>
  <head>
      <style>
        h1,h4{
          text-align: center;
        }
        img{
          display: block;
          height: 105px;
          margin: 0 auto
        }
        .guide{
          background-color: rgb(206, 209, 139);
        }
        table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
      </style>
    
  </head>
<body>
  <h1>Simple calculation generation</h1>
  <p style="background-color: rgb(206, 209, 139);">2. Read through the <strong>Introduction to the simple Calculation Question</strong> and <strong>Question Generation Priority</strong>, choose the 
  priority of question you want to generate.</p>
<hr>

<h4>Introduction to the simple Calculation Question:</h4>
<a href="https://eq1302.cs.cityu.edu.hk/question/preview.php?id=4049&amp;cmid=782" style="text-align: center;" target="_blank">See a sample question here</a>

<ol>
  <li>
    Question title: A question title is used to identify a question in a question bank. As the example below shows, a question is titled as FillinBlankQ-SimpleCalc, the question is represented by its question title.
    <img src = "simpCalcImg//question title.png" style="height: 93px;">
  </li>

  <li> Question text:
    In question text for simple calculation questions, normally numbers or mathmatical expressions are included. For example:</li>
    <img src= "simpCalcImg//questionText.png" style="height: 105px">
  <li>
  <p>Question answer: question answer will check the result of students&#39; inputs. For example:</p>
<p>This is an correct answer:</p>
<img src= "simpCalcImg//correctAnswer.png" style="height: 105px">
This is a wrong answer:
<img src= "simpCalcImg//wrongAnswer.png" style="height: 105px">
</p></li>
<li><p>Advanced function-- Randomization:
Suppose there a question text with some numbers or expressions . Furthermore, we can generate different question variants <strong>randomly</strong> for the question. This means that different students may get different versions of the question generated with diverse numbers or expressions.  Let&#39;s take the question generated in the above as an example. 
<img src= "simpCalcImg//2question.png" style="height: 105px">
The randomization can be used in higher priority. For details, please refer to the <strong>Question Generation Priority</strong>.</p></li></ol>
<hr>
<h4>Question Generation Priority</h4>

<p>To make ones get familiar to STACK question step by step, we generate three priorities, from low to high:  Beginner, Intermedia, Professional.
Here is the difference:</p>
<ul>
  <li>
    Beginner:
    Write explicit question text and answers.
  </li>
  <li>
    Intermedia:
Use the advanced randomization function, but the range of numbers can not be controlled by users.
  </li>

  <li>
    Professional:
Use the advanced randomization function, users can customize the range of random numbers.
  </li>
</ul>
<hr>
<h4>Select a priority to generate a question:</h4>
  <div>
    <form id="questionLevel" method="GET">
      <input type="radio" name="priority" value="beginner" /> Beginner
      <input type="radio" name="priority" value="Intermedia" /> Intermedia
      <input type="radio" name="priority" value="Professional" /> Professional
    </form>
    <div>
      <input type="button" name="Submit" value="Submit" onClick="display();" /><span id="hint0" >(Scroll now after you click it)</span>
    </div>

    <div id="01">
      <p   class = "guide"> 3. Please read the sample output and related input for generate a sample addition question, then change the related input to generate quesiton.</p>
      <p id = "beginner guide" class = "guide">In beginner level, you should input the following three parts. Here we have already prepare a demo question which have already filled the form.</p>
      <p id = "intermedia guide" class = "guide">In Intermedia level, you need to use variable names to represent random numbers. Besides three main parts, you need to add variables in your question text. Please use {@ @} to include the variable name in the question text. And give the variable name and lowerbound of the variable value in the variable table below. Furthermore, you should also determine 
          how many variants you want to determined. A demo code is shown below.</p>
        <p id = "professional guide"  class = "guide">In Professional level, you should input the variable names, the lower bound and the upper bound for variables.</p>
      <p>A sample output is: </p>
      <img src = "simpCalcImg//beginner.png" id = "beginner">
      <img src= "simpCalcImg//2question.png" style="height: 105px" id = "nonBeginner">
      <p>Please input the <strong>question title</strong> in the below box.</p>
      <textarea id="question title" rows="3" cols="20"> Sample question 1</textarea>
      <p>Please input the <strong>question text</strong> in the below box. </p>
      <textarea id="question text" rows="3" cols="20"> </textarea>
      <p>
        Please input the <strong>question answer</strong> in the below box.
      </p>
      <textarea id="question answer" rows="3" cols="20"> </textarea>
    </div>
    <div id="02">
      <p>
        The number of variants you want to generate is:
        <input type="number" id="02Num" value="10"/>
      </p>
      <h4>        Variable List (Fill two blocks below add click <strong>add</strong> to add a variable</h4>
      <input type="text" id="shop" />
      <input type="text" id="cellPhone" />
      <button id="add">add</button>

      <table id="ITable">
        <thead>
          <tr>
            <th>Variable Name</th>
            <th>Variable Lowerbound</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>var1</td>
            <td>5</td>
            <td style="text-align: center;">
							<button onclick="deleteData(this)" type="button" class="btn btn-danger">Delete</button>
						</td>
          </tr>
          <tr>
            <td>var2</td>
            <td>10</td>
            <td style="text-align: center;">
							<button onclick="deleteData(this)" type="button" class="btn btn-danger">Delete</button>
						</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="03">
      <p>
        The number of variants you want to generate is:
        <input type="number" id="03Num" />
      </p>
      <input type="text" id="shop2" />
      <input type="text" id="cellPhone2" />
      <input type="text" id="cellPhone3" />

  
      <button id="add2">add</button>

      <table id="PTable">
        <thead>
          <tr>
            <th>Variable Name</th>
            <th>Variable Lower Bound</th>
            <th>Variable Upper Bound</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>var1</td>
            <td>10</td>
            <td>20</td>
            <td style="text-align: center;">
							<button onclick="deleteData(this)" type="button" class="btn btn-danger">Delete</button>
						</td>
          </tr>
          <tr>
            <td>var2</td>
            <td>5</td>
            <td>20</td>
            <td style="text-align: center;">
							<button onclick="deleteData(this)" type="button" class="btn btn-danger">Delete</button>
						</td>
          </tr>
        </tbody>
      </table>
    </div>
    <input type="button" value="Click to generate XML file" id="Confirm" onclick="BGenerateXML()" />
    <!-- <div id = "xmlImportGuide" name = "guide">
      <p>Please copy the xml code below and create a new file with the suffix xml on your computer. Paste the code into the new file.
        <img src = "simpCalcImg/xmlFile.png">
        Then enter the setting page of the quiz you want to add. click import.
        <img src = "simpCalcImg/import.png">
        Select your newly created file, and the categories you want to place. then import.
        <img src = "simpCalcImg/import2.png">

        Then you can find the question in question bank.</p>
        <img src = "simpCalcImg/check.png">

    </div> -->
    <div id = "xmlImportGuide" >
      
			<p class = "guide" >4. Please copy the xml code below and create a new file with the suffix xml on your computer. Paste the code into the new file.</p>
			  <img src = "simpCalcImg/xmlFile.png" style="height: 50px;">
			  <p class = "guide" >5. Then enter the setting page of the quiz you want to add. click import.</p>
			  <img src = "simpCalcImg/import.png" style="height: 300px;">
			 <p class = "guide" >6. Select your newly created file, and the categories you want to place. then import.</p> 
			  <img src = "simpCalcImg/import2.png"  style="height: 300px;">
	  
			  <p class = "guide" >7. Then you can find the question in question bank.</p>
			  <img src = "simpCalcImg/check.png"  style="height: 300px;">
        <p class = "guide">Moreover, <strong>for Intermedia and professional level</strong> , you need to deploy the variants in <strong>Editing settings</strong> part(It can be accessed through the first option in the img below the 5th step.</p>
        <img src="simpCalcImg\deploy0.png" style="height: 150px;">
        <p class = "guide">Fill the blank with the number of variants you expected. </p>
        <img src = "simpCalcImg\deploy1.png" style="height: 150px;">
		  </div>
    <div>
      <textarea name="output" id="output" cols="30" rows="10"></textarea>
    </div>
   

  </div>

  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script src="./src/FileSaver.js"></script>
  <script src="./src/xmlReader.js"></script>

  <script>
    //-----------------------------------------------------------------------------------------------默认值
    var basicContent = document.getElementById("01");
    var tableContent = document.getElementById("02");
    var tableContent2 = document.getElementById("03");
    var beginnerImg = document.getElementById("beginner");
    var nonBeginnerImg = document.getElementById("nonBeginner");

    var ITable = document.getElementById("ITable");
    var Confirm = document.getElementById("Confirm");
    var output = document.getElementById("output");
    var beginnerGuide = document.getElementById("beginner guide");
    var intermediaGuide = document.getElementById("intermedia guide");
    var professionalGuide = document.getElementById("professional guide");
    var xmlImportGuide = document.getElementById("xmlImportGuide");
       
    basicContent.style.display = "none";
    tableContent.style.display = "none";
    tableContent2.style.display = "none";
    ITable.style.display = "none";
    Confirm.style.display = "none";
    output.style.display = "none";
    beginnerImg.style.display="none";
    nonBeginnerImg.style.display="none";
    beginnerGuide.style.display="none";
    intermediaGuide.style.display="none";
    professionalGuide.style.display="none";
    xmlImportGuide.style.display= "none";
        //-----------------------------------------------------------------------------------------------submit 事件

    function display() {
      var ident = $("input[name = 'priority']:checked").val();
      if (ident == "null") alert("Please select an option");
      else {
        document.getElementById("hint0").setAttribute("style","color:red");
        basicContent.style.display = "block";
        Confirm.style.display = "block";

        document.getElementById("question text").value = "Given 7 and 13, please give a result after addition:";
        document.getElementById("question answer").value = "20";
        if (ident == "Beginner"){
          beginnerGuide.style.display="block";
          beginnerImg.style.display="block";


        }
        if (ident == "Intermedia") {
          //注意判断身份中用单引号

          intermediaGuide.style.display="block";
          tableContent.style.display = "block";
          nonBeginnerImg.style.display="block";
          let ITable = document.getElementById("ITable");
          ITable.style.display = "block";
          document.getElementById("question text").value = "Given {@var1@} and {@var2@} please give a result after addition:";
        document.getElementById("question answer").value = "var1+var2";

          
        } else if (ident == "Professional") {
          professionalGuide.style.display="block";
          tableContent2.style.display = "block";
          nonBeginnerImg.style.display="block";
          document.getElementById("question text").value = "Given {@var1@} and {@var2@} please give a result after addition:";
          document.getElementById("question answer").value = "var1+var2";

        }
      }
    }

    //-----------------------------Table 的基本操作
    let table = document.getElementById("ITable");
    let tHead = table.tHead;
    let tBody = table.tBodies[0];
    let shop = document.getElementById("shop");
    let cellPhone = document.getElementById("cellPhone");
    let add = document.getElementById("add");
    add.onclick = function () {
      let tr = document.createElement("tr");
      let td1 = document.createElement("td");
      td1.innerHTML = shop.value;
      tr.appendChild(td1);

      let td2 = document.createElement("td");
      td2.innerHTML = cellPhone.value;
      tr.appendChild(td2);

      var td3 = document.createElement("td");
			var button3 = document.createElement("button");
			button3.type = "button";
			button3.className = "btn btn-danger";
			button3.setAttribute("onclick","deleteData(this)");
			td3.setAttribute("style","text-align: center");
      var TextButton = document.createTextNode("Delete");
			button3.appendChild(TextButton);
      td3.appendChild(button3);
      tr.appendChild(td3);
      

      tBody.appendChild(tr);
    };
    function deleteData(btn){
			var childTd = btn.parentNode;
			var childTr = childTd.parentNode;
			var parentTbody = childTr.parentNode;
			parentTbody.removeChild(childTr);
		} 

    let table2 = document.getElementById("PTable");
    let tHead2 = table2.tHead;
    let tBody2 = table2.tBodies[0];
    let shop2 = document.getElementById("shop2");
    let cellPhone2 = document.getElementById("cellPhone2");
    let cellPhone3 = document.getElementById("cellPhone3");

    let add2 = document.getElementById("add2");
    add2.onclick = function () {
      let tr = document.createElement("tr");
      let td1 = document.createElement("td");
      td1.innerHTML = shop2.value;
      tr.appendChild(td1);

      let td2 = document.createElement("td");
      td2.innerHTML = cellPhone2.value;
      tr.appendChild(td2);

      let td3 = document.createElement("td");
      td3.innerHTML = cellPhone3.value;
      tr.appendChild(td3);

      var td4 = document.createElement("td");
			var button4 = document.createElement("button");
			button4.type = "button";
			button4.className = "btn btn-danger";
			button4.setAttribute("onclick","deleteData(this)");
			td4.setAttribute("style","text-align: center");
      var TextButton = document.createTextNode("Delete");
			button4.appendChild(TextButton);
      td4.appendChild(button4);
      tr.appendChild(td4);

      tBody2.appendChild(tr);
    };

    //--------------------------------------------------------------------------------------------confirm 事件
    Confirm.onclick = function () {
      var ident = $("input[name = 'priority']:checked").val();
      document.getElementById("output").style.display = "block";
      xmlDoc = getXMLDOM("simpCalc.xml");
     
        let questionText = document.getElementById("question text");
        let questionAns = document.getElementById("question answer");
        let questionTitle = document.getElementById("question title");
        let questionVariableContent = "";
        let questionNoteContent = "{@ta@}";
        let xmlImportGuide = document.getElementById("xmlImportGuide");
        xmlImportGuide.style.display= "block";
        questionTextContent = questionText.value;
        questionAnsContent = questionAns.value;
        questionTitleContent = questionTitle.value;

      if (ident == "beginner") {
        
       
      }
      else if (ident == "Intermedia") {
        let questionNum = parseInt(document.getElementById("02Num").value);
        // let ITable = document.getElementById("ITable");
        let tData = getTableContent("ITable")
        let variableNum = tData.length;
        let randUpperBound = questionNum*3/(variableNum-1);
        questionVariableContent = "randNum : rand("+ randUpperBound+");\n";
        for (let i = 1; i < variableNum; i++) {
          questionVariableContent += tData[i][0] +": "+ tData[i][1]+"+ "+ "randNum\n";
          questionNoteContent += "{@"+tData[i][0]+"@} "
      }
        
      } else {
        let questionNum = parseInt(document.getElementById("02Num").value);
        let tData = getTableContent("PTable");
        let variableNum = tData.length;
        for (let i = 1; i < variableNum; i++) {
          questionVariableContent += tData[i][0] +": "+ tData[i][1]+"+ "+ "rand("+tData[i][2]+");\n";
          questionNoteContent += "{@"+tData[i][0]+"@} "

      }
    }
      questionVariableContent += "ta : "+questionAnsContent;
      xmlDoc.getElementsByTagName("text")[0].childNodes[0].nodeValue = questionTitleContent;
    xmlDoc.getElementsByTagName("text")[1].childNodes[0].nodeValue = "<![CDATA[<p></p><p>" + questionTextContent + "</p><p>[[input:ans1]] [[validation:ans1]]</p>";

    xmlDoc.getElementsByTagName("questionvariables")[0].childNodes[0].nodeValue = "<text>" + questionVariableContent+"</text>";
    xmlDoc.getElementsByTagName("questionnote")[0].childNodes[0].nodeValue = "<text>" + questionNoteContent+"</text>";
      
     let str = getSerialXML(xmlDoc);
      let reg = new RegExp("<text/>","g");
      str = str.replace(reg,"<text></text>");
    //  document.getElementById("output").innerHTML = str;
    let fileName = questionTitleContent+".xml";
    xmlDownload(str,fileName);
   
  }
</script>
</body>

</html>